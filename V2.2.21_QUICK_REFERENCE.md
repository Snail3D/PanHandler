# v2.2.21 Quick Reference - Map Mode Persistence

## Bug Fixed
Map mode state was not restored when returning to the app after leaving.

## The Problem
- Set up map scale (e.g., `1 cm = 1 km`)
- Make measurements
- Leave app
- Return to app
- **Bug:** Map scale was lost, had to re-enter ❌

## The Fix
Added logic to restore map mode state from persisted calibration data.

## How It Works Now
1. Leave app with map mode active
2. Return to app
3. Map scale automatically restored ✅
4. All measurements preserved ✅
5. Badge shows correct scale ✅

## Technical Details
**File:** `/src/components/DimensionOverlay.tsx` (lines 519-531)

**Logic:**
- When calibration is restored from AsyncStorage, check if `calibrationType === 'verbal'`
- If yes, restore `isMapMode = true` and `mapScale` from `calibration.verbalScale`
- If coin/blueprint calibration, ensure map mode is OFF

## New Photo Still Works
Taking a new photo still clears map scale correctly (no regression).

---

## Complete Session Summary (v2.2.18 → v2.2.21)

### v2.2.18 - Two Features
1. **Undo single point** - Remove just last point, not entire measurement
2. **Feet/inches formatting** - Display as `45'1"` instead of `45.05 ft`

### v2.2.19 - Bug Fix
3. **Polygon auto-detection disabled** - Lines no longer auto-merge into triangles

### v2.2.20 - Smart Units
4. **Smart map scale unit switching** - Automatic unit conversion when switching metric ↔ imperial

### v2.2.21 - Persistence Fix
5. **Map mode persistence** - Map scale now restores when returning to app

All features tested and working! ✅
