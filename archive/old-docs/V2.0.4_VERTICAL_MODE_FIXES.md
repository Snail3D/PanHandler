# v2.0.4 - Vertical Mode Fixes

## Version
**2.0.3 → 2.0.4**

## Problems Fixed

### 1. 🔄 "Look Down" Message Not Fading Properly
**User Report**: "The look down isn't working. That fade between the look down and that button when I look up, it doesn't change back and forth"

**Root Cause**: 
The comparison logic was broken:
```javascript
const wasHorizontal = isHorizontal.value;
isHorizontal.value = absBeta < 45;
if (wasHorizontal !== isHorizontal.value) { // This always fails!
```

The issue: After assigning the new value to `isHorizontal.value`, comparing it to `wasHorizontal` would always be false because we're comparing the old value to itself after assignment.

**Fix** (lines 619-622):
```javascript
const wasHorizontal = isHorizontal.value;
const nowHorizontal = absBeta < 45; // Calculate NEW value first
isHorizontal.value = nowHorizontal; // Then assign
if (wasHorizontal !== nowHorizontal) { // Now comparison works!
```

**Result**: 
- ✅ "Look Down" appears when phone is vertical (upright)
- ✅ Instructions appear when phone is horizontal (looking down)
- ✅ Smooth 500ms fade transition between the two states

---

### 2. 🚫 Auto-Capture Disabled in Vertical Mode
**User Request**: "Obviously auto mode should be disabled completely if it's not in horizontal"

**Implementation** (lines 734-750):
- Added check: `const phoneIsHorizontal = isHorizontal.value;`
- If NOT horizontal, auto-capture returns early
- Debug log: "Auto-capture disabled in vertical mode - use quick tap"

**Result**:
- ✅ Auto-capture ONLY works in horizontal mode (looking down)
- ✅ Vertical mode: user must quick tap to capture
- ✅ Prevents accidental auto-capture when phone is upright

---

### 3. ✅ Manual Capture Still Works in Vertical Mode
**User Request**: "The user should still be able to snap a vertical or portrait photo in the vertical orientation by a quick press"

**Already Working**: Quick tap (< 200ms) always triggers `takePicture()` regardless of orientation (line 1861 in shutter button logic)

**Result**:
- ✅ Quick tap works in ANY orientation
- ✅ Hold for auto-capture ONLY in horizontal mode
- ✅ Best of both worlds: precision auto-capture + manual fallback

---

### 4. 🎯 Center Crosshairs Always Visible
**User Request**: "Can you have the justice center crosshairs stay on"

**Already Working**: Center crosshairs (gray lines at center of screen) are always rendered and visible (lines 1444-1468)

**Result**:
- ✅ Center crosshairs visible in both horizontal and vertical modes
- ✅ Only the floating RED level lines fade in/out based on orientation

---

### 5. 🌊 Graceful Fade for Level Lines
**User Request**: "I want to gracefully disappear and reappear as it goes in the vertical or horizontal mode"

**Already Working**: Red level lines use animated opacity with `withTiming` (lines 1371 and 1405)

**Result**:
- ✅ Red level lines fade out gracefully when phone goes vertical
- ✅ Red level lines fade in gracefully when phone goes horizontal
- ✅ Smooth transitions via Reanimated withTiming

---

## Summary of Vertical vs Horizontal Modes

| Feature | Horizontal Mode (Looking Down) | Vertical Mode (Upright) |
|---------|-------------------------------|-------------------------|
| **Center Crosshairs** | ✅ Visible | ✅ Visible |
| **Red Level Lines** | ✅ Visible (fades in) | ❌ Hidden (fades out) |
| **Auto-Capture** | ✅ Enabled (hold shutter) | ❌ Disabled |
| **Quick Tap** | ✅ Works | ✅ Works |
| **Instructions** | ✅ Shows instructions | ❌ Shows "Look Down" |

---

## Technical Details

**Files Modified**:
- `src/screens/MeasurementScreen.tsx`
  - Fixed "Look Down" fade logic (lines 619-622)
  - Added auto-capture disable in vertical mode (lines 744-750)
- `app.json` - Version bump to 2.0.4

**Key Changes**:
1. Fixed orientation detection comparison logic
2. Added horizontal-only check to auto-capture useEffect
3. Confirmed all other behaviors already working as requested

---

## Testing

### Test "Look Down" Fade:
1. Hold phone upright (vertical) → Should see "Look Down" message
2. Tilt phone down (horizontal) → "Look Down" fades out, instructions fade in
3. Tilt back up → Instructions fade out, "Look Down" fades in

### Test Auto-Capture:
1. Hold shutter in horizontal mode → Auto-capture works when aligned
2. Hold shutter in vertical mode → Auto-capture disabled (debug log confirms)
3. Quick tap in ANY mode → Always captures

### Test Visual Elements:
1. Center crosshairs → Always visible in both modes
2. Red level lines → Fade in/out gracefully based on orientation

---

## Notes
- Fix was simple: comparison logic bug in orientation detection
- All other requested features were already implemented correctly
- Smooth transitions maintained throughout
