# V1.91 Quick Reference

## What's New

### 1. Press-and-Hold Auto-Capture âœ¨
- **Quick Tap**: Take photo immediately (< 200ms)
- **Press & Hold**: Wait for perfect alignment
  - Button turns crosshair color
  - Photo captures when bubble centered
  - Release to cancel

### 2. Fixed Photo Picker ðŸ“¸
- Smooth transition to calibration after selecting photo
- No more confusion after import

### 3. Auto Album Opening ðŸ“‚
- Photos save to "PanHandler" album
- iOS: Photos app opens automatically
- Android: Album in gallery

## User Flows

### Manual Capture (Quick Tap)
```
1. Tap shutter < 200ms
2. Photo captures immediately
3. â†’ Calibration screen
4. Photo saved to PanHandler album
5. iOS: Photos app opens
```

### Auto-Capture (Hold)
```
1. Press and hold shutter button
2. Button â†’ crosshair color (visual feedback)
3. Adjust phone while holding
4. Lines align â†’ Auto capture!
5. â†’ Calibration screen
6. Photo saved to PanHandler album
7. iOS: Photos app opens
```

### Import Photo
```
1. Tap photo library button (bottom-left)
2. Select photo from library
3. â†’ Smooth fade to calibration
4. Ready to calibrate & measure
```

## Technical Details

### Shutter Button States
- **Normal**: Shutter color (contrasting, from v1.90)
- **Pressed**: 80% opacity
- **Holding**: Border & inner â†’ crosshair color

### Hold Detection
- < 200ms = Quick tap â†’ immediate capture
- â‰¥ 200ms = Hold â†’ wait for alignment
- `holdStartTimeRef` tracks duration

### Auto-Capture Conditions
```typescript
isHoldingShutter === true
&& alignmentStatus === 'good'
&& isStable === true
â†’ takePicture()
```

### Album Save Flow
```typescript
1. Create asset â†’ MediaLibrary.createAssetAsync()
2. Get/create album â†’ MediaLibrary.getAlbumAsync('PanHandler')
3. Add to album â†’ MediaLibrary.addAssetsToAlbumAsync()
4. Open Photos (iOS) â†’ Linking.openURL('photos-redirect://')
```

## Testing Checklist

âœ… Quick tap shutter â†’ immediate capture
âœ… Hold shutter â†’ button changes color
âœ… Hold shutter â†’ auto-capture when aligned
âœ… Release while holding â†’ cancels auto-capture
âœ… Photo library button â†’ picker opens
âœ… Select photo â†’ smooth transition to calibration
âœ… Photos save to "PanHandler" album
âœ… iOS: Photos app opens after save
âœ… Android: Photos save (no app opening)

## Code Locations

**Shutter Button**: `MeasurementScreen.tsx` lines 1769-1810
**Hold Handlers**: `onPressIn` (line 1770), `onPressOut` (line 1776)
**Auto-Capture Effect**: Lines 717-731
**Photo Picker**: `pickImage` function, lines 1165-1203
**Album Save**: Lines 1054-1080

## Backwards Compatibility

âœ… All v1.90 features preserved
âœ… Color system unchanged
âœ… Quick-tap behavior identical to v1.90
âœ… No breaking changes

## Version
**1.91** (October 17, 2025)
