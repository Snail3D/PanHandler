# V2.2.13 - Fixed Unable to Take Picture After Canceling Calibration

## Issue
After going to calibration screen and pressing back button, camera wouldn't let user take another picture.

## Root Cause
Race condition in `handleCancelCalibration` function. The order of state updates was:

**Before:**
```typescript
setImageUri(null);           // 1. Clear image first
setCoinCircle(null);
setCalibration(null);
setMode('camera');           // 2. Then set mode to camera
setSelectedCoin(null);
```

This triggered a useEffect conflict (lines 918-922):
```typescript
useEffect(() => {
  if (!currentImageUri && mode !== 'camera') {
    setMode('camera');  // ← Also tries to set mode!
  }
}, [currentImageUri, mode]);
```

**What Happened:**
1. `handleCancelCalibration` called
2. `setImageUri(null)` → triggers useEffect
3. useEffect sees `!currentImageUri && mode !== 'camera'` → tries to `setMode('camera')`
4. `handleCancelCalibration` also calls `setMode('camera')`
5. Race condition / conflicting state updates
6. Camera doesn't reinitialize properly
7. `isCameraReady` stays false or `cameraRef` is null
8. Can't take picture ❌

## Fix
Reordered state updates to set mode BEFORE clearing image:

**After:**
```typescript
setMode('camera');          // 1. Set mode to camera FIRST
setImageUri(null);          // 2. Then clear image
```

This prevents the useEffect from triggering because `mode === 'camera'` already when image is cleared.

## Why This Works
1. `setMode('camera')` happens first
2. Camera component remounts
3. `useEffect` for camera mode runs (lines 925-964)
4. Camera fade-in animation starts
5. `setImageUri(null)` happens after
6. useEffect sees `mode === 'camera'` → doesn't trigger
7. No race condition
8. Camera ready after 850ms
9. User can take picture ✅

## Expected Behavior Now
1. User takes photo
2. Goes to calibration screen
3. Presses back button  
4. Returns to camera mode
5. Camera fades in (600ms animation)
6. After 850ms total → camera ready
7. Can take another photo ✅

## Files Modified
- `/home/user/workspace/src/screens/MeasurementScreen.tsx`

## Version
v2.2.13
