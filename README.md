# 📐 PanHandler

> Transform your iPhone into a precision measurement tool — no hardware needed, just a coin.

<p align="center">
  <strong>Professional measurements • CAD-ready exports • Free forever</strong><br>
  <em>Built for makers, builders, and creators everywhere</em>
</p>

---

## 🎯 What is PanHandler?

PanHandler turns your iPhone camera into a professional measurement tool using coin-based calibration and advanced computer vision. Measure distances, angles, areas, and more with CAD-level precision — perfect for construction, design, engineering, and everyday projects.

**No expensive laser tools. No subscriptions. Just your phone and a coin.**

---

## ✨ Features at a Glance

### 📏 Measurement Tools

| Tool | Description | Perfect For |
|------|-------------|-------------|
| **📐 Distance** | Measure straight-line distances between two points | Room dimensions, furniture sizing, material lengths |
| **📐 Angle** | Three-point angle measurements with azimuth bearing | Corner angles, slopes, directional bearings |
| **⭕ Circle** | Radius, diameter, area, and circumference | Pipes, vents, circular objects, curved surfaces |
| **▭ Rectangle** | Length, width, and area calculations | Walls, windows, doors, frames, boxes |
| **〰️ Freehand** | Trace custom paths and irregular shapes | Wire routing, curved edges, complex contours |

### 🪙 Smart Calibration

- **650+ Coins Supported** — From 130+ countries worldwide, every continent covered
- **Map Scale Mode** — Measure directly from blueprints, maps, and drawings
- **Auto-Level Capture** — Hold your phone level and it auto-captures perfectly straight photos
- **Precision Lock-In** — Professional-grade accuracy for CAD workflows
- **One-Time Setup** — Calibration remembered for future sessions

### 🎨 Beautiful Interface

- **Glassmorphic UI** — Smooth, modern, watery design aesthetic
- **Color-Coded Measurements** — Each measurement type has its own vibrant color
- **Haptic Feedback** — Satisfying tactile responses throughout the app
- **Smart Snapping** — Measurements auto-snap to horizontal/vertical for perfect alignment
- **Gesture Controls** — Pan, pinch-zoom, and tap with intuitive interactions

### 💾 Export Options

- **📧 Email Reports** — Send measurements with annotated photos
- **📸 Save to Photos** — Export images with measurements burned in
- **📐 CAD Export** — DXF format for professional workflows
- **🏷️ Custom Labels** — Name your measurements for clarity

---

## 🚀 How to Use PanHandler

### Step 1: 📸 Take a Perfect Photo

**Position matters for accuracy:**

- **Hold camera perpendicular (90°)** to your subject
  - Flat surfaces: Look straight down
  - Vertical surfaces: Face directly at walls/objects
- **Distance matters:**
  - Closer = Better detail (but fit everything in frame)
  - Farther = Less detail (but wider coverage)
- **Use the bubble level** — Green circle shows when phone is level
- **Auto-capture enabled?** — Hold level for 2 seconds to auto-snap
- **Tap shutter button** to capture manually
- **Import existing photos** via "Add Photos" button

---

### Step 2: 🪙 Calibrate with a Coin

**Set your scale for accurate measurements:**

1. **Search for your coin** — 650+ coins from 130+ countries
2. **Place the coin** in your photo (or nearby on the surface)
3. **Zoom and position** the calibration circle
4. **Align edges perfectly** — Match the outer circle edge to the coin
5. **Tap "Lock In Calibration"** when ready

💡 **Pro Tip:** Made a mistake? Tap the red **Recalibrate** button below the calibration badge to start over!

---

### Step 3: 📏 Place Measurements

**Choose your measurement type and start measuring:**

#### 📐 Distance Mode
- Tap to place two points
- Get instant distance measurement
- **Pro Tip:** Connect multiple lines to create triangles and polygons — **areas are automatically calculated!**

#### 📐 Angle Mode
- Place first endpoint → vertex (corner) → second endpoint
- See angle in degrees
- In Map Mode, this becomes **Azimuth Mode** for directional bearings

#### ⭕ Circle Mode
- Tap center point
- Tap edge to define radius
- Get diameter, circumference, and **area automatically**

#### ▭ Rectangle Mode
- Tap two opposite corners
- Get length, width, and **area automatically**
- Edges snap to perfect horizontal/vertical lines

#### 〰️ Freehand Mode
- Draw custom paths for any shape
- Perfect for wire paths, curved edges, or irregular contours
- **🎯 Lasso Mode:** Close the loop by ending near your start point — get **perimeter and area!**

---

### Step 4: 📤 Export Your Work

**Share your measurements professionally:**

- **Email** — Send annotated photos with all measurements
- **Save to Photos** — Export high-quality images with measurements
- **CAD Export (DXF)** — Import into AutoCAD, Fusion 360, SolidWorks, etc.
- **Custom Labels** — Tap "Edit Labels" to name measurements before exporting

---

## 🎓 Tips & Tricks

### 📸 Getting the Best Photos

- **Lighting is key** — Use natural light when possible
- **Avoid shadows** — They can distort measurements
- **Keep phone steady** — Use the bubble level for perfect alignment
- **Zoom calibration** — If initial photo is too far, you can zoom during calibration!

### 🎯 Measurement Accuracy

- **Tap-to-Focus** — Tap screen to auto-focus camera before capture
- **Sub-pixel precision** — Crosshair cursor snaps to exact pixel locations
- **Multi-measurement workflows** — Place multiple measurements on same photo
- **Pan & Edit Modes:**
  - **Pan Mode** — Navigate around your photo
  - **Measure Mode** — Place new measurements
  - **Edit Mode** — Adjust existing measurement points

### 🗺️ Map Mode

Want to measure from maps, blueprints, or technical drawings?

1. Import your map/blueprint photo
2. In calibration, tap **"Map Mode"**
3. Enter the scale (e.g., "1:100" or "1 inch = 10 feet")
4. Measure directly on the drawing!

---

## 🎬 Learn with Video Tutorials

Watch our complete video course on YouTube!

**[📹 PanHandler YouTube Course](https://www.youtube.com/playlist?list=PLJB4l6OZ0E3HRdPaJn8dJPZrEu4dPBDJi)**

**Course includes:**
- Getting started tutorials
- Advanced measurement techniques
- Real-world workflow examples
- Tips & tricks for best results

---

## 💰 Pricing

### 🎉 Free Forever

That's right — **completely free, forever.**

- ✅ Unlimited measurements
- ✅ Unlimited exports
- ✅ All measurement tools (Distance, Angle, Circle, Rectangle, Freehand)
- ✅ Coin + Map calibration
- ✅ CAD export (DXF format)
- ✅ Email reports with photos
- ✅ All features included

**No subscriptions. No in-app purchases. No hidden fees.**

---

## 🏆 Why Choose PanHandler?

### vs. Tape Measures
- ✅ Faster and more accurate
- ✅ Digital records you can share
- ✅ Measure from photos anytime

### vs. Laser Measuring Tools
- ✅ Free vs. $50-$200
- ✅ No extra device to carry
- ✅ Measure multiple dimensions from one photo

### vs. Other Measurement Apps
- ✅ Real calibration (not guessing)
- ✅ CAD-ready DXF exports
- ✅ Professional precision
- ✅ Beautiful, intuitive interface

---

## 📱 Use Cases

### 🏗️ Construction & Contractors
- Room dimensions and layout verification
- Material quantity calculations
- Quick on-site estimates
- Client documentation

### 🎨 Interior Design & Architecture
- Furniture sizing and space planning
- Blueprint measurements
- Decoration placement
- Field verification

### 📦 E-commerce & Shipping
- Product dimensions for listings
- Packaging size calculations
- Shipping cost estimates
- Accurate product photos

### 🏡 Real Estate
- Property measurements
- Room dimensions for listings
- Lot sizes
- Professional listing photos

### 🛠️ DIY & Home Improvement
- Project planning
- Material shopping
- Renovation measurements
- Furniture builds

---

## 🏗️ Technical Details

### How It Works

**The Math Behind the Magic:**

```
1. User zooms image to match coin to reference circle
2. App calculates: pixelsPerMM = (circleDiameter / zoomScale) / coinDiameterMM
3. For any measurement: realWorldDistance = pixelDistance / pixelsPerMM
```

**Why It's Accurate:**
- Coin diameters are precisely known (standardized minting)
- Zoom calibration captures exact image scale
- Sub-pixel precision cursor for point placement
- Mathematical verification at every step

### Tech Stack

- **Platform:** React Native 0.76.7 (iOS optimized)
- **Framework:** Expo SDK 53
- **State Management:** Zustand + AsyncStorage
- **Gestures:** react-native-gesture-handler
- **Animations:** react-native-reanimated v3
- **Styling:** NativeWind (Tailwind CSS for React Native)

### Project Structure

```
src/
├── components/
│   ├── CalibrationModal.tsx         # Coin selection UI
│   ├── CoinCalibration.tsx          # Zoom calibration
│   ├── DimensionOverlay.tsx         # Main measurement UI (6000+ lines)
│   ├── HelpModal.tsx                # Comprehensive in-app guide
│   └── BattlingBotsModal.tsx        # Easter egg hints
├── screens/
│   ├── MeasurementScreen.tsx        # Main container
│   └── CameraScreen.tsx             # Photo capture + bubble level
├── state/
│   └── measurementStore.ts          # Zustand store (persistent)
├── utils/
│   ├── coinReferences.ts            # 650+ coin database
│   ├── unitConversion.ts            # Metric/Imperial conversions
│   ├── deviceScale.ts               # 1.2X tablet scaling
│   └── chuckNorrisJokes.ts          # Easter egg content
└── types/
    └── measurement.ts               # TypeScript types
```

---

## 🎮 Easter Eggs

PanHandler has a few fun hidden surprises! Can you find them all?

**Hints:**
- Something about snails... 🐌
- Music lovers, pay attention to the help screen... 🎵
- Chuck Norris doesn't measure things... ⚡

Want more hints? Look for the "Battling Bots" modal (long-press the left egg 7 times)!

---

## 🔧 Development

### Setup

```bash
# Install dependencies
bun install

# Start development server (auto-managed by Vibecode)
# Server runs on port 8081

# Type checking
bun tsc --noEmit
```

### Development Notes

- All timer/subscription cleanup is critical to prevent memory leaks
- React Native Pressable fires both `onPress` and `onLongPress` events
- `useAnimatedStyle` hooks must be defined at top level (never conditionally)
- Tablet support: 1.2X scaling on iPad/Android tablets (automatic detection)

---

## 📚 Documentation

- **[DEVELOPMENT.md](./DEVELOPMENT.md)** — Developer guide: architecture, setup, debugging, formulas
- **[CLAUDE.md](./CLAUDE.md)** — Current session notes (resets each session)
- **[/archive/](./archive/)** — Historical docs and session notes

---

## 🎯 Roadmap

### ✅ v7.5.0 (Current)
- **Quadrillion suffix support for Lake Michigan-scale measurements**
  - Added Q (quadrillion) suffix for ultra-massive volumes and areas
  - Lake Michigan volume now displays as `1.18Q gal` instead of `1180.00T gal`
  - All formatters support Q → T → B → M → K hierarchy
  - Applied to volumes (m³, L, ft³, gal) and areas (km², mi², ha, ac)
- **Intelligent area unit scaling for small measurements**
  - Areas now automatically scale to the most readable unit (e.g., `3.32K mm²` → `33.2 cm²`)
  - Lowered mm²→cm² threshold from 10000 mm² (100 cm²) to 1000 mm² (10 cm²) for better readability
  - Small areas < 1000 mm² (10 cm²) stay in mm² for precision (e.g., `785 mm²`)
  - Imperial areas only show acres when >= 0.01 ac (no more "0.00 ac" on drink cans!)
  - Updated both legend rendering and formatBlueprintArea to use intelligent scaling
  - On-photo circle labels now recalculate area when switching unit systems
  - Large-scale units (mi, km, ft, m) still use custom logic with acres/hectares
  - Works for all small-scale calibrations (mm, cm, in)
- **Fixed circle area calculations for Known Scale mode (blueprint calibrations)**
  - Circles now correctly display area in mi²/km² instead of ft²/cm²
  - Imperial: `⌀ 478.23 mi (A: 179.62K mi² (114.96M ac))` ✅
  - Metric: `⌀ 769.71 km (A: 465.32K km²)` ✅
- **Fixed circle area parsing for K/M suffixes when switching units**
  - Regex now correctly parses diameter values with K/M suffixes (e.g., `⌀ 1.58K km`)
  - Prevents parsing errors that treated "K" as the unit instead of the suffix
  - Circle with 1580 km diameter now shows `A: 1.96M km²` instead of incorrect `A: 1821.5 cm²`
  - Works for both K (thousands) and M (millions) suffixes
- **Fixed rectangle dimensions not converting with Known Scale calibrations**
  - Rectangle dimensions now convert when switching unit systems (e.g., `565 mi` → `909.26 km`)
  - Fixed `formatMapValue()` to respect user's unit system preference
  - Works for all measurement types with Known Scale calibrations (e.g., "200mi between points")
- **Fixed rectangle areas not converting (formatBlueprintArea issue) - THE BIG FIX**
  - Rectangle areas now convert properly: `146.73K mi²` → `380.21K km²` ✅
  - Root cause: Known Scale calibrations use blueprint code path, not map mode path
  - Added `currentUnitSystem` parameter to `formatBlueprintArea()` with conversion logic
  - Both dimensions AND areas now respect user's unit preference
  - Example: `659.06 km × 576.60 km (A: 380.21K km²)` instead of showing mi²/acres
- **Fixed regex parsing for circle diameter with feet symbols**
  - Corrected pattern to only match letters for units, not digits
  - Prevents `⌀ 172'` from being parsed as diameter=17, unit="2"
- **Fixed freehand volume display in legend**
  - Volume now displays correctly for closed freehand loops
  - Format: `perimeter ⊞ area | V: volume`
  - Works for both metric (m³, L) and imperial (ft³, gal)
- **Fixed misleading hectare/acre display for small areas**
  - Areas < 0.01 ha/ac no longer show "0.00" conversions
  - Example: `⌀ 65 mm (A: 32.7 cm²)` instead of `(A: 3.27K mm² (0.00 ha))`
  - Applies to all units: ft², m², in², cm², mm²
  - Large areas still show conversions when meaningful (>= 0.01 ha/ac)
- All v7.4.x features included

### ✅ v7.4.0 (Previous)
- **Fixed circle area calculations for Known Scale mode (blueprint calibrations)**
  - Circles now correctly display area in mi²/km² instead of ft²/cm²
  - Imperial: `⌀ 478.23 mi (A: 179.62K mi² (114.96M ac))` ✅
  - Metric: `⌀ 769.71 km (A: 465.32K km²)` ✅
- **Fixed circle area parsing for K/M suffixes when switching units**
  - Regex now correctly parses diameter values with K/M suffixes (e.g., `⌀ 1.58K km`)
  - Prevents parsing errors that treated "K" as the unit instead of the suffix
  - Circle with 1580 km diameter now shows `A: 1.96M km²` instead of incorrect `A: 1821.5 cm²`
  - Works for both K (thousands) and M (millions) suffixes
- **Fixed rectangle dimensions not converting with Known Scale calibrations**
  - Rectangle dimensions now convert when switching unit systems (e.g., `565 mi` → `909.26 km`)
  - Fixed `formatMapValue()` to respect user's unit system preference
  - Works for all measurement types with Known Scale calibrations (e.g., "200mi between points")
- **Fixed rectangle areas not converting (formatBlueprintArea issue) - THE BIG FIX**
  - Rectangle areas now convert properly: `146.73K mi²` → `380.21K km²` ✅
  - Root cause: Known Scale calibrations use blueprint code path, not map mode path
  - Added `currentUnitSystem` parameter to `formatBlueprintArea()` with conversion logic
  - Both dimensions AND areas now respect user's unit preference
  - Example: `659.06 km × 576.60 km (A: 380.21K km²)` instead of showing mi²/acres
- **Fixed regex parsing for circle diameter with feet symbols**
  - Corrected pattern to only match letters for units, not digits
  - Prevents `⌀ 172'` from being parsed as diameter=17, unit="2"
- **Fixed freehand volume display in legend**
  - Volume now displays correctly for closed freehand loops
  - Format: `perimeter ⊞ area | V: volume`
  - Works for both metric (m³, L) and imperial (ft³, gal)
- **Fixed misleading hectare/acre display for small areas**
  - Areas < 0.01 ha/ac no longer show "0.00" conversions
  - Example: `⌀ 65 mm (A: 3.32K mm²)` instead of `(A: 3.32K mm² (0.00 ha))`
  - Applies to all units: ft², m², in², cm², mm²
  - Large areas still show conversions when meaningful (>= 0.01 ha/ac)
- All v7.0.x features included

### ✅ v7.0.2 (Previous)
- Fixed circle area calculations in Known Scale mode
- Circles with large diameters (e.g., 461.57 mi) now show correct areas
- Removed backwards conversion logic from legend rendering
- All v7.0.1 and v7.0.0 features included

### ✅ v7.0.1 (Previous)
- Fixed circle area unit mismatch for imperial map calibrations
- Map calibrations now keep values in original unit system
- All v7.0.0 features included

### ✅ v7.0.0 (Previous)
- Improved rectangle labeling system
- Labels now show before dimensions in legend
- Fixed label edit mode interaction
- K/M suffixes for large numbers (distances, areas, volumes)
- Multi-line wrapping for long legend entries
- Fixed circle area display for imperial map calibrations
- Enhanced UI polish and consistency
- All v6.0 features included

### ✅ v6.0 (Previous)
- Core measurement tools complete
- Coin + map calibration
- Export system (Email, Photos, DXF)
- Comprehensive help system
- Tablet support (1.2X scaling)
- Easter eggs implemented

### 🔜 Beta (Next)
- App Store submission
- TestFlight beta testing
- User feedback iteration
- Performance optimization
- Marketing assets

### 🚀 Future Ideas
- Apple Watch calibration
- Batch measurements
- Measurement templates
- Cloud sync (optional)
- AR mode (iOS 17+)

---

## 👨‍💻 Credits

**Created by:** [Snail](https://youtube.com/@realsnail3d) (3D Designer)
**Mission:** Make CAD designing faster, easier, and more accurate for everyone

**Development Partner:** Ken (AI Agent at Vibecode)
**Launch:** October 2025

---

## 📄 License

Proprietary — All rights reserved

---

## 🚀 Status

**Version:** v7.6.3
**Status:** Production Ready 🔥
**Platform:** iOS (iPhone + iPad)

**This is production-ready. Ship it.**

For App Store launch checklist, see [APP_STORE_LAUNCH_GUIDE.md](./APP_STORE_LAUNCH_GUIDE.md)

---

## 📝 Recent Updates

### v7.6.3 - Memory Leak Fixes (App-Backgrounding Performance)
- ✅ **Fixed:** Memory leak in CameraScreen - zoomSaveTimeoutRef never cleared on unmount
- ✅ **Fixed:** Memory leak in DimensionOverlay - 9 timeout/interval refs never cleared on unmount
- Fixed refs: freehandActivationTimer, azimuthTapTimeout, imperialTapTimeout, calibratedTapTimeout, autoLevelTapTimeout, undoTimeout, undoInterval, freehandLongPress, hapticTimers array, lockInTimers array
- Added cleanup useEffect to both components to clear all timers on unmount
- Should fix the "app gets slower when I come back into it" issue
- Prevents timer accumulation when switching between camera/measurement modes

### v7.6.2 - Unified Smooth Performance (User-Preferred Standard)
- ✅ **Standardized:** 50ms sensor rate (20fps) for ALL devices - dev, production, budget, flagship
- ✅ **Standardized:** Every 3rd frame UI updates (~6.7fps) for ALL devices
- User testing showed this speed feels better across the board - smooth, not sluggish
- Consistent experience for everyone regardless of device
- Better battery life and lower CPU usage while maintaining smoothness
- Eliminates device-specific quirks and performance variations

### v7.6.1 - Budget Android Phone Optimization
- ✅ **Improved:** Enhanced low-end device detection to identify budget Android phones
- ✅ **Optimized:** More aggressive throttling for budget devices (every 3 frames instead of 2)
- Detects Android phones from 2018-2020 with <4GB RAM as budget devices
- Budget devices: 50ms sensor rate + every 3rd frame = ~6.7fps UI updates (still smooth)
- Regular production: 33ms sensor rate + every 2nd frame = 15fps UI updates
- Ensures smooth performance even on budget Android devices without looking laggy

### v7.6.0 - Production Build Performance Optimization
- ✅ **Fixed:** Reduced DeviceMotion sensor update rate in production from 60fps to 30fps
- ✅ **Fixed:** Throttled state updates to every other frame in production (15fps UI updates)
- Reduces CPU load from 240 state updates/sec to 60 state updates/sec in production
- Dev builds still run at 60fps for smooth debugging
- Should significantly improve camera/shutter responsiveness in TestFlight/App Store builds

### v7.5.9 - CRITICAL Performance Fix - AlertModal Spam
- ✅ **Fixed:** Removed AlertModal render logging causing HUNDREDS of logs per second
- AlertModal was re-rendering constantly with debug logging, completely killing performance
- Removed console.log from AlertModal component and showAlert function
- **This was the root cause of all the slowness!**

### v7.5.8 - Critical Performance Fix
- ✅ **Fixed:** Removed debug console.logs that were causing severe slowness in dev and TestFlight
- ✅ **Fixed:** Map mode selection now works correctly (added missing setCapturedPhotoUri)
- Removed 9 unguarded console.log statements that were running in production
- App should now run at full speed again

### v7.5.7 - Performance Fix
- ✅ **Fixed:** Photo selection lag - removed blocking `await` on image orientation detection
- Modal now appears immediately after selecting a photo instead of freezing with just a checkmark
- Orientation detection runs in background without blocking UI

### v7.5.6 - Simplified Email Workflow
- ✅ **Removed:** Saved email address functionality - simplified to use Mail.app defaults
- ✅ **Removed:** Email prompt modal and long-press Help button reset
- Email button now opens Mail.app directly with pre-populated subject, body, and 2 attachments
- Share button provides quick sharing via iOS share sheet (AirDrop, Messages, etc.)
- Both buttons remain side-by-side for different use cases

### v7.5.5 - Alert Modal Debugging
- ✅ **Added:** Comprehensive debug logging for long-press Help button email reset
- Debug logs now track: long-press trigger → showAlert call → AlertModal render
- Added `statusBarTranslucent` prop to AlertModal for better compatibility
- Will help diagnose why modal doesn't appear on some devices

### v7.5.4 - Save Button → Share Button
- ✅ **Changed:** Save button is now Share button with iOS share sheet
- Share measurements via AirDrop, Messages, WhatsApp, or any app
- Email button still opens Mail.app directly with pre-populated email and attachments
- Keep the old Save to Photos functionality by using standard iOS share → Save Image

### v7.5.3 - Email & Sharing Fixes
- ✅ **Fixed:** Long-press Help button (?) now clears saved email address
- ✅ **Fixed:** Email export now uses iOS Share sheet when Mail.app not configured
- Share measurements via Messages, AirDrop, WhatsApp, or any app
- Proper file sharing with expo-sharing instead of broken Share API

### v7.5.2 - Email Export Fix
- ✅ **Fixed:** Email export no longer shows blank/blurred screen
- Screen now properly restores before opening email composer
- Better error handling and logging for email flow
- Prevents UI from getting stuck if user cancels email

### v7.5.1 - Panning Fix
- ✅ **Fixed:** Single-finger panning now works in measurement mode after coin calibration
- Previously required 2 fingers; now supports 1-finger pan for easier navigation

### v7.5.0 - Area & Volume Display Improvements
- ✅ Intelligent area unit scaling (3.32K mm² → 33.2 cm²)
- ✅ Lower threshold for mm²→cm² conversion (from 10000 to 1000)
- ✅ Fixed imperial areas showing "0.00 ac" for small measurements
- ✅ Added Q (quadrillion) suffix support for Lake Michigan-scale measurements

---

<p align="center">
  <strong>Made with ❤️ for makers, builders, and creators everywhere.</strong><br>
  <em>Measure anything. Anytime. Anywhere.</em>
</p>

---

## 💬 Support & Feedback

- **YouTube:** [@realsnail3d](https://youtube.com/@realsnail3d)
- **Email:** Contact us via the app's email feature
- **Bug Reports:** Found an issue? Let us know!

---

**📐 PanHandler — Professional measurements from your pocket.**
